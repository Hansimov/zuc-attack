%# -*- coding: utf-8-unix -*-
%%==================================================
%% 01_crypto.tex % 4k
%%==================================================

\chapter{现代密码学与旁路攻击}

\section{现代密码学} % 1k

由于目前应用在实际生活中的绝大多数密码学理论都属于现代密码学，因此我们讨论的重点也集中在现代密码学。

现代密码学和古典密码学的一个重要区别是：现代密码学构建在严格的数学论证和完备的系统架构之上。目前普遍使用的算法也都是现代密码算法，并且经过许多分析、攻击和改进，才渐渐保证其理论上的安全性。 \cite{cryptography_foundations}

信息安全是现代密码学的一个重要应用领域。衡量信息安全的指标包括：保密性、完整性、认证性、不可否认性以及可用性。要达成这些严格的指标，就需要同样严格的现代密码学体系支撑。这些安全指标有些是彼此掣肘的，因此在设计一个密码系统时，需要综合各方面的因素，才能达到预期的目的，保证系统的安全性。

现代密码学遵循一些基本的准则，比如柯克霍夫原则（Kerckhoffs's principle）。该原则指出，系统的安全性不应依赖于具体实现的保密性。信息论的创始人香农（Shannon）也说：“敌人了解系统。”这些原则来源于历史上的经验和教训：几乎所有尝试隐藏算法和系统实现方式本身的做法，最后都失败了。

这些原则促进了通用算法的公开和评审，现实表明，公开的算法经过层层筛选和多次改进，具备更加优良的理论安全性和实际可用性。因此，当前应用广泛的许多密码算法都是公开透明的。我们在进行密码学分析和旁路攻击时，不需要在获取算法细节方面花费不必要的工夫（不过，相应地，这也意味着这些算法本身已经具有极高的安全性，想要分析和攻击它们是一件非常困难的事情）。 \cite{cryptography_basic}

划分现代密码学有很多依据，其中一个就是密钥的特征，分为对称密码学和非对称密码学。对称密码学应用的一个典型是 AES（Advanced Encryption Standard，高级加密标准）算法，其特点是加密和解密使用相同的密钥。非对称密码学应用的代表是 RSA（Rivest–Shamir–Adleman）算法，其特点是加密和解密使用不同的密钥。\cite{modern_cryptography}

相比非对称密码学，旁路攻击在对称密码学方面的研究相对多一些。一方面可能是因为对称密码算法加解密采用同一密钥，破解密钥更有意义；另一方面是由于非对称密码算法常常要进行大数运算，速度比对称密码算法要慢很多，因而在对性能要求较高的工业密码设备中，非对称密码算法应用较少，也就造成了实际样本较少，并且研究动力不足。本文涉及的祖冲之算法，也是对称密码算法中的一种。

% 现代密码学 - 百度文库
%   https://wenku.baidu.com/view/7d3a5991daef5ef7ba0d3cce.html

% 现代密码学第1章：现代密码学概论
%   https://wenku.baidu.com/view/f79db2c79ec3d5bbfd0a749c.html

% 流密码与分组密码 - 百度文库
%   https://wenku.baidu.com/view/65316c2300f69e3143323968011ca300a6c3f6d8.html

\section{密码设备} % 1k
数学家和密码学家们常常关注理论层面，试图从根本上提高密码算法的安全性，而工程师则更多地和现实打交道，将这些纸上的东西转化成真正能够工作的软硬件设备。也正是由于这种分工，熟悉密码学理论的数学家和密码学家们难以注意到现实设备在实现时可能存在的安全隐患，而整天从事软硬件设备开发和维护的工程师，也鲜有人能够通晓算法背后的原理，从而留下一些潜在的可以利用的漏洞和瑕疵。

上一小节我们简单提及了密码学的理论部分，因此这一小节我们将讲述一些和实际密码设备相关的知识。了解密码设备的软硬件构成，有助于我们掌握实际设备的特性，以及可能出现的信息泄露点，为我们的旁路攻击打下必要的基础。

密码算法的执行通常涉及到两部分，一部分是数据的保存，另一部分是数据的操作。相应地，密码设备也可以分为两种，一种是保存数据的存储设备，另一种是操作数据的处理设备。

\vspace*{\baselineskip}

密码设备一般拥有这几个部分：

\begin{itemize}
\item \textbf{专用硬件：}比如执行特定密码算法的电路
\item \textbf{通用硬件：}比如控制算法流程的控制电路
\item \textbf{存储硬件：}用于存储数据和程序
\item \textbf{接口：}用于规定数据的输入和输出
\end{itemize}

\vspace*{\baselineskip}

密码设备通常由数字电路实现，不同部分既可以在同一块芯片上完成，也可以分到多个芯片上。我们这里以单芯片的密码设备为例。通常，单芯片数字电路可以通过两种方式实现，一种是 FPGA（Field Programmable Gate Array， 现场可编程门阵列），另一种是 ASIC （Application-Specific Integrated Circuit，专用集成电路）。虽然用不同方式实现的密码设备在运行性能、工作场景以及成本上有所不同，但实现流程却基本相同。

不管是 FPGA 还是 ASIC，其本质都是数字电路。数字电路的基本组成部分是各种逻辑元件。通常有两种逻辑元件，一种是组合元件，实现基本的逻辑功能，比如与、或、非，另一种是时序元件，比如触发器、锁存器以及寄存器。时序元件和组合元件最大的不同是，时序元件的输出不仅取决于当前的输入，还和元件当前的状态有关。

目前，在实现逻辑元件的工艺中，以 CMOS（Complementary Metal Oxide Semiconductor， 互补金属氧化物半导体）最为常见。

\section{旁路攻击} % 2k
传统的密码学分析试图挖掘算法本身存在的问题，抑或是寻找某些数学前提和密码学假设的漏洞，从而在根本上攻破某一密码学算法或系统。一旦从理论上揭露了某种密码学算法或系统的潜在问题，那么暴露出来的问题就是致命的，使用这些算法或系统的设备要么被废弃，要么经受升级和改进，否则就不能消除安全隐患。

然而，正如上文提到的，由于现代密码学主张密码算法设计的公开化和透明化，因此，大多数现在广泛使用的密码算法和系统都经过了严格的论证、长期的研究和持续的改进。一方面，对于使用这些算法和系统的设备来说，安全性得到了极大的提升；另一方面，对于相关领域的研究人员和攻击者来说，使用传统方法破解算法或者是提取算法中的重要信息，变得日益困难。

虽然现代密码学的严格化和公开化的初衷正在于更好地保障信息安全，但是这对攻击者和研究人员无疑也是巨大的挑战：攻击者需要开发更强大的武器和工具，花费更多的时间和成本，才能达成攻击目的；而研究人员也需要付出更多的精力和汗水，掌握更多的数学知识，才能驾驭日益复杂的密码算法。

而旁路分析的出现，则提供了另一种截然不同的思路，并且打开了一扇通往新世界的大门。旁路分析的思路和方法五花八门，各有千秋，狭义上的旁路攻击通常指被动型非侵入式攻击，也就是说，这类攻击只是对密码设备的各种攻击方法的一小部分。但是广义上的旁路攻击则包含各种非传统意义上的密码分析手段。

以攻击密码设备时使用的接口作为分类依据，一般将攻击的方式划分为三种：侵入式攻击，半侵入式攻击非和侵入式攻击。

\vspace*{\baselineskip}

下面对这三类攻击作一些简单的介绍和说明： \cite{paa_cn}

\begin{itemize}
\item \textbf{侵入式攻击（Invasive Attacks）：}能够进行侵入式攻击的人通常能够对密码设备拥有较长时间的物理接触权限，因而可以对设备进行非常仔细的拆卸和分解，能够获得设备详尽的信息和状况。不过，要完成侵入式攻击，付出的代价也相对高，比如需要探测台和激光切片器这样昂贵的仪器和技术。

\item \textbf{半侵入式攻击（Semi-Invasive Attacks）：}半侵入式攻击一般也要对密码设备进行一定程度的拆卸和分解，但是通常不会破坏芯片的钝化膜，不直接接触芯片的表面。半侵入式攻击相比侵入式攻击，在仪器上花费的成本要低一些，但如何选择正确的部位以从设备中读取泄露的信息依旧要耗费大量的时间。比如常见的故障攻击，就属于半侵入式攻击的范畴。

\item \textbf{非侵入式攻击（Non-Invasive Attacks）：}相比上面两种攻击，非侵入式攻击成本是最低的，并且在攻击完成后，不会有明显的痕迹。狭义上的旁路攻击，就属于非侵入式攻击，只利用设备合法的接口以及泄露的侧信道信息，就能通过数学手段提取出设备中的敏感内容。正因为非侵入式攻击所需的设备以及花费的代价很低，因此比前两种攻击应用更加广泛，威胁也更大。
\end{itemize}

\vspace*{\baselineskip}

从具体的实施手段上讲，常见的旁路攻击有这些方式： \cite{sca_ten_year}

\begin{itemize}
\item \textbf{时序攻击（Timing Attack）：}设备中的程序在运行时，不同的指令和操作耗时并不是相等的。如果这些指令和操作中包含秘密参数，那么执行时间上的差异就有可能将这些信息泄露出去。如果对设备或算法的具体实现非常了解，甚至可以结合统计学的方法将秘密参数完全恢复出来。
\item \textbf{功耗分析攻击（Power Analysis Attack）：}功耗分析攻击通常应用于硬件设备。在执行不同的指令或者处理不同的数据时，设备散发的功耗也是存在差异的。功耗分析通常也分为简单功耗分析和差分功耗分析。在各种各样的旁路攻击方式中，功耗分析攻击是研究最为成熟的，其方法最为系统，防护的方案也最多，是当前旁路攻击研究领域中的热门方向。
\item \textbf{电磁攻击（Electro Magnetic Attack）：}除了功耗之外，设备在运行时还会发出电磁辐射。同样地，设备的指令和数据也会影响电磁辐射的特征。和功耗分析攻击类似，电磁攻击也分为简单电磁攻击和差分电磁攻击。军方很久之前就已经注意到了这种攻击，比如美国国家安全局。虽然功耗分析攻击和电磁攻击使用的方法和思路非常类似，但电磁攻击有时候比功耗分析更加强大，采用了功耗分析防护方案的设备有时候也不能抵挡电磁攻击。
\item \textbf{可见光攻击（Visible Light Attack）：}攻击者们还注意到了设备的光学信息。比如有研究表明，阴极射线显像管（CRT）产生的光在投射到墙壁上，并且经过漫反射后，依旧可能泄露设备的相关信息。相同的技术也可以应用到发光二极管（LED）上。可见光攻击的一大优点就是不需要物理接触设备，这是大部分其他攻击方式都不具备的。
\item \textbf{声学攻击（Acoustic Attack）：}处理器在执行操作时也会泄露声学信息，通过分析声学信息的差异，也有可能获取相关的秘密信息。但这一领域尚处在早期阶段，还没有出现成熟的应用。
\item \textbf{故障攻击（Fault Attack）：}大部分算法和程序都假定设备能够正常工作，很多防护方案也是基于这一前提。然而，如果设备的某些部分或者操作出现故障，一旦涉及到处理秘密信息的操作，那么就有可能泄露这方面的信息。事实上，在针对智能卡的攻击方面，故障攻击是非常实用和有效的一种。研究和实验表明，几乎所有的密码算法都无法抵御故障攻击。不过实施有效的故障攻击需要很多基本条件，因此难度相对较高。
\item \textbf{错误消息攻击（Error Message Attack）：}这里的消息通常是指发给设备的指令或者参数。很多设备在处理输入参数时，需要验证格式的合法性，然后返回一定的信息。如果合理的构造某些特殊的消息输入设备，攻击者就有可能从返回结果中得到有用的信息，借此恢复秘密内容。
\item \textbf{缓存攻击（Cache-based Atack）：}缓存攻击的思路某种程度上和计时攻击有些相像。数据和指令一般从内存经过缓存再到处理器，如果某些数据在处理器中没有找到（miss，或者说未命中），那么就会有一个延时，这个延时用于从内存中导入相关的数据到缓存中。通过这个延时，攻击者能够分析出缓存未命中的出现及其频率，从而进一步分析出相关信息。
\item \textbf{频率攻击（Frequency-based Attack）:}在进行功耗分析攻击或电磁攻击时，如果时域上的曲线没有处理好（对齐、滤波），从频域上也能得到有用的信息。
\item \textbf{扫描攻击（Scan-based Attack）：}在集成电路测试中，扫描技术很常见。到攻击者手中，则成了一个强大的武器。有研究和实验表明，在运行 DES 算法的设备上，可以通过扫描链技术恢复出对应的密钥。
\item \textbf{组合旁路攻击（Combination of Side Channel Attacks）：}单一的旁路攻击技术可能不足以实施成功的攻击，因此攻击者和研究人员驶入结合多信道对设备进行分析和攻击，比如计时攻击与功耗分析攻击结合，功耗分析攻击与电磁攻击结合。
\item \textbf{结合数学分析的旁路攻击（Combination of SCA and Mathematical Attacks）：}传统的密码学分析已经相当成熟，因此一旦结合旁路攻击得到部分有用的信息，整个算法就有可能被全盘攻破。数学分析与旁路攻击结合，将会是非常强大的攻击手段。

\end{itemize}










